<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NederLingo | æ—¥æœ¬èªâ‡”ã‚ªãƒ©ãƒ³ãƒ€èªãƒ•ãƒ¬ãƒ¼ã‚ºå­¦ç¿’</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f7f7fb;
      --fg: #1f2933;
      --accent: #ff7a59;
      --accent-dark: #c24e31;
      --card-bg: #ffffff;
      --muted: #5f6c7b;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f172a;
        --fg: #e2e8f0;
        --card-bg: #16203a;
        --muted: #8ea4c4;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 24px 20px 16px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      letter-spacing: 0.04em;
    }

    header p {
      margin: 12px auto 0;
      max-width: 720px;
      font-size: 1rem;
      color: var(--muted);
      line-height: 1.6;
    }

    main {
      flex: 1;
      width: min(960px, 92vw);
      margin: 0 auto 48px;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .mode-switcher {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .mode-button {
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 51, 0.12);
      background: rgba(31, 41, 51, 0.04);
      color: inherit;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, border 0.2s ease-in-out, color 0.2s ease-in-out;
    }

    .mode-button:hover,
    .mode-button:focus-visible {
      background: rgba(31, 41, 51, 0.08);
      border-color: rgba(31, 41, 51, 0.24);
      outline: none;
    }

    .mode-button[aria-selected="true"] {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
    }

    .mode-panel-group {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .mode-panel {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(15, 23, 42, 0.05);
    }

    .setup-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .setup-list li {
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(255, 122, 89, 0.08);
      border: 1px dashed rgba(255, 122, 89, 0.4);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .phrase-list {
      list-style: none;
      margin: 24px 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .phrase-list li {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      align-items: center;
      font-size: 1rem;
      line-height: 1.8;
    }

    .phrase-original {
      font-weight: 600;
    }

    .phrase-translation {
      color: var(--muted);
    }

    .toggle-translation {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: white;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }

    .toggle-translation:hover,
    .toggle-translation:focus {
      background: var(--accent-dark);
    }

    .toggle-translation:focus {
      outline: 2px solid rgba(255, 122, 89, 0.3);
      outline-offset: 2px;
    }

    .speak-phrase,
    .recognize-phrase {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      background: rgba(31, 41, 51, 0.1);
      color: var(--fg);
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, color 0.2s ease-in-out;
    }

    .speak-phrase:hover,
    .speak-phrase:focus,
    .recognize-phrase:hover,
    .recognize-phrase:focus {
      background: rgba(31, 41, 51, 0.18);
    }

    .speak-phrase:disabled,
    .recognize-phrase:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .recognition-panel {
      border-radius: 16px;
      background: rgba(31, 41, 51, 0.06);
      padding: 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.9rem;
    }

    .recognition-panel strong {
      font-weight: 600;
      color: var(--fg);
    }

    .recognition-panel span {
      word-break: break-word;
    }

    .recognition-notice {
      margin-top: 12px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .speech-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .speech-controls input[type="range"] {
      accent-color: var(--accent);
    }

    .is-hidden {
      visibility: hidden;
    }

    .phrase-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .phrase-section h3 {
      margin: 0;
      font-size: 1.35rem;
    }

    .game-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .game-intro p {
      margin: 0;
      line-height: 1.6;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .game-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      align-items: center;
    }

    .game-meta .meta-box {
      border-radius: 14px;
      background: rgba(31, 41, 51, 0.06);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .meta-label {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .meta-value {
      font-size: 1.35rem;
      font-weight: 700;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .meta-value small {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--muted);
    }

    .game-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .game-button {
      padding: 10px 18px;
      border-radius: 12px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
      background: var(--accent);
      color: #ffffff;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .game-button:hover,
    .game-button:focus-visible {
      background: var(--accent-dark);
      transform: translateY(-1px);
      outline: none;
    }

    .game-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .game-button.secondary {
      background: rgba(31, 41, 51, 0.08);
      color: var(--fg);
    }

    .game-status {
      min-height: 1.4em;
      font-size: 0.95rem;
      color: var(--fg);
    }

    .game-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    .game-card {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border-radius: 18px;
      padding: 16px;
      background: var(--card-bg);
      border: 2px solid transparent;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.1);
      transition: transform 0.18s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .game-card[data-lang="ja"] {
      background: linear-gradient(135deg, rgba(255, 225, 215, 0.45), rgba(255, 255, 255, 0.8));
    }

    .game-card[data-lang="nl"] {
      background: linear-gradient(135deg, rgba(210, 230, 255, 0.4), rgba(255, 255, 255, 0.85));
    }

    .game-card-main {
      border: none;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 14px;
      padding: 16px;
      font-size: 1.05rem;
      font-weight: 600;
      text-align: center;
      color: var(--fg);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .game-card[data-lang="nl"] .game-card-main {
      font-size: 1rem;
    }

    .game-card-main:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .game-card-label {
      display: block;
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    .game-card-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .card-action {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      background: rgba(31, 41, 51, 0.12);
      color: var(--fg);
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.15s ease;
    }

    .card-action:hover,
    .card-action:focus-visible {
      background: rgba(31, 41, 51, 0.2);
      outline: none;
      transform: translateY(-1px);
    }

    .card-action:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .game-card-hint {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
      white-space: pre-wrap;
      text-align: center;
      min-height: 1.3em;
    }

    .game-card.is-selected {
      border-color: var(--accent);
      transform: translateY(-4px);
    }

    .game-card.is-matched {
      border-color: var(--accent);
      animation: cardMatch 520ms ease;
      box-shadow: 0 16px 32px rgba(255, 122, 89, 0.32);
    }

    .game-card.is-disabled {
      pointer-events: none;
      opacity: 0.6;
    }

    .score-pulse {
      animation: scorePulse 420ms ease;
    }

    @keyframes scorePulse {
      0% {
        transform: scale(1);
      }

      40% {
        transform: scale(1.15);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes cardMatch {
      0% {
        transform: scale(0.96);
      }

      60% {
        transform: scale(1.08);
      }

      100% {
        transform: scale(1);
      }
    }

    .phrase-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      background: rgba(255, 255, 255, 0.02);
    }

    .phrase-table th,
    .phrase-table td {
      padding: 12px 14px;
      border-bottom: 1px solid rgba(96, 110, 133, 0.18);
      text-align: left;
      vertical-align: top;
    }

    .phrase-table thead th {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .phrase-table tbody tr:last-child td {
      border-bottom: none;
    }

    .phrase-table td strong {
      display: block;
      font-size: 1rem;
    }

    @media (max-width: 640px) {
      .game-meta {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .game-card-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 14px;
      }

      .game-card {
        padding: 14px;
      }

      .game-card-main {
        font-size: 1.1rem;
        padding: 18px 12px;
      }

      .card-action {
        font-size: 0.9rem;
        padding: 7px 14px;
      }

      .phrase-table thead {
        display: none;
      }

      .phrase-table,
      .phrase-table tbody,
      .phrase-table tr,
      .phrase-table td {
        display: block;
        width: 100%;
      }

      .phrase-table tr {
        padding: 12px 0;
        border-bottom: 1px solid rgba(96, 110, 133, 0.18);
      }

      .phrase-table tbody tr:last-child {
        border-bottom: none;
      }

      .phrase-table td {
        border: none;
        padding: 6px 0;
      }

      .phrase-table td::before {
        content: attr(data-label);
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
        margin-bottom: 4px;
      }
    }

    @media (max-width: 480px) {
      .game-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .game-card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }

      .game-card {
        padding: 12px;
      }

      .game-card-main {
        font-size: 1.2rem;
      }

      .game-card-actions {
        gap: 6px;
      }
    }

    [hidden] {
      display: none !important;
    }

    footer {
      text-align: center;
      padding: 24px 16px 32px;
      font-size: 0.85rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <h1>NederLingo</h1>
    <p>
      æ—¥æœ¬èªã¨ã‚ªãƒ©ãƒ³ãƒ€èªã®ãƒ•ãƒ¬ãƒ¼ã‚ºç·´ç¿’ã‚’ã€ç›®çš„ã«åˆã‚ã›ã¦åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ‰å­¦ç¿’ä½“é¨“ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚
    </p>
    <p>
      è½ã¡ç€ã„ã¦ç™ºéŸ³ã‚„æ„å‘³ã‚’ç¢ºèªã§ãã‚‹ã€Œãƒ•ãƒ¬ãƒ¼ã‚ºå­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã€ã¨ã€ä»Šå¾Œå…¬é–‹äºˆå®šã®å¯¾æˆ¦è¦ç´ ã‚’å‚™ãˆãŸã€Œãƒ•ãƒ¬ãƒ¼ã‚ºãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã€ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã€è‡ªåˆ†ã«åˆã£ãŸãƒªã‚ºãƒ ã§å­¦ã³ã¾ã—ã‚‡ã†ã€‚
    </p>
  </header>

  <main>
    <div class="main-container" data-active-mode="study">
      <div class="mode-switcher" role="tablist" aria-label="å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ">
        <button
          id="mode-tab-study"
          class="mode-button"
          type="button"
          role="tab"
          aria-controls="mode-panel-study"
          aria-selected="true"
          data-mode="study"
        >
          ãƒ•ãƒ¬ãƒ¼ã‚ºå­¦ç¿’ãƒ¢ãƒ¼ãƒ‰
        </button>
        <button
          id="mode-tab-game"
          class="mode-button"
          type="button"
          role="tab"
          aria-controls="mode-panel-game"
          aria-selected="false"
          tabindex="-1"
          data-mode="game"
        >
          ãƒ•ãƒ¬ãƒ¼ã‚ºãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰
        </button>
      </div>

      <div class="mode-panel-group">
        <section
          id="mode-panel-study"
          class="mode-panel"
          role="tabpanel"
          aria-labelledby="mode-tab-study"
          aria-hidden="false"
          data-mode-panel="study"
        >
          <section class="card">
            <h2>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>
            <ul class="setup-list">
              <li>æ—¥æœ¬èªâ‡”ã‚ªãƒ©ãƒ³ãƒ€èªã®ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’æ•´å‚™ã™ã‚‹</li>
              <li>ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«é–²è¦§ãƒ»ç·´ç¿’ã§ãã‚‹UIã‚’è¨­è¨ˆã™ã‚‹</li>
              <li>æ¤œç´¢ã‚„ç™ºéŸ³ã‚µãƒãƒ¼ãƒˆãªã©ã®æ©Ÿèƒ½ã‚’æ¤œè¨ã™ã‚‹</li>
            </ul>
          </section>

          <section class="card">
            <h2>æ—¥å¸¸ãƒ•ãƒ¬ãƒ¼ã‚ºé›†</h2>
            <div class="speech-controls">
              <label for="speech-rate">å†ç”Ÿé€Ÿåº¦: <span id="speech-rate-value">1.0x</span></label>
              <input type="range" id="speech-rate" name="speech-rate" min="0.6" max="1.4" step="0.1" value="1">
            </div>
            <ul class="phrase-list" data-phrase-list></ul>
            <div id="recognition-panel" class="recognition-panel is-hidden" aria-live="polite">
              <p class="recognition-status"><strong>çŠ¶æ…‹:</strong> <span id="recognition-status">ãƒã‚¤ã‚¯ã®è¨±å¯ã‚’ä¸ãˆã¦ã€Œç™ºå£°ãƒ†ã‚¹ãƒˆã€ã‚’æŠ¼ã™ã¨ç™ºéŸ³ãƒã‚§ãƒƒã‚¯ãŒã§ãã¾ã™ã€‚</span></p>
              <p class="recognition-target"><strong>ç›®æ¨™ãƒ•ãƒ¬ãƒ¼ã‚º:</strong> <span id="recognition-target">-</span></p>
              <p class="recognition-result"><strong>èªè­˜çµæœ:</strong> <span id="recognition-text">-</span></p>
              <p class="recognition-score"><strong>ãƒãƒƒãƒç‡:</strong> <span id="recognition-score">-</span></p>
            </div>
            <p id="speech-recognition-notice" class="recognition-notice is-hidden" aria-live="polite"></p>
          </section>

          <section class="card phrase-section">
            <h3>æŒ¨æ‹¶</h3>
            <table class="phrase-table">
              <thead>
                <tr>
                  <th scope="col">æ—¥æœ¬èª</th>
                  <th scope="col">ã‚ªãƒ©ãƒ³ãƒ€èª</th>
                  <th scope="col">ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚</strong>ä¸å¯§ãªæœã®æŒ¨æ‹¶</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Goedemorgen.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ•ãƒ¼ãƒ‡ãƒ¢ãƒ«ãƒ˜ãƒ³ /É£udÉ™ËˆmÉ”r.É£É™(n)/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã“ã‚“ã«ã¡ã¯ã€‚</strong>æ—¥ä¸­ã®æŒ¨æ‹¶</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Goedemiddag.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ•ãƒ¼ãƒ‡ãƒŸãƒ€ãƒ• /É£udÉ™ËˆmÉªdÉ‘x/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã“ã‚“ã°ã‚“ã¯ã€‚</strong>å¤•æ–¹ä»¥é™ã®æŒ¨æ‹¶</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Goedenavond.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ•ãƒ¼ãƒ‡ãƒŠãƒ¼ãƒ•ã‚©ãƒ³ãƒˆ /É£udÉ™ËˆnaËvÉ”nt/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã¯ã˜ã‚ã¾ã—ã¦ã€‚</strong>åˆå¯¾é¢ã®æŒ¨æ‹¶</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Aangenaam.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ã‚¢ãƒ¼ãƒãƒŠãƒ¼ãƒ  /ËˆaËÅ‹É£É™naËm/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã•ã‚ˆã†ãªã‚‰ã€‚</strong>åˆ¥ã‚Œã®æŒ¨æ‹¶</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Tot ziens.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒˆãƒƒãƒ„ã‚£ãƒ³ã‚¹ /tÉ”t Ëˆzins/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã¾ãŸå¾Œã§ã­ã€‚</strong>ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªåˆ¥ã‚Œ</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Tot later.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒˆãƒˆ ãƒ©ãƒ¼ãƒ†ãƒ« /tÉ”t ËˆlaËtÉ™r/</td>
                </tr>
              </tbody>
            </table>
          </section>

          <section class="card phrase-section">
            <h3>æ—…è¡Œ</h3>
            <table class="phrase-table">
              <thead>
                <tr>
                  <th scope="col">æ—¥æœ¬èª</th>
                  <th scope="col">ã‚ªãƒ©ãƒ³ãƒ€èª</th>
                  <th scope="col">ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ</strong>å ´æ‰€ã‚’å°‹ã­ã‚‹</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Waar is het station?</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ¯ãƒ¼ãƒ« ã‚¤ã‚¹ ãƒ˜ãƒƒãƒˆ ã‚¹ã‚¿ã‚·ã‚ªãƒ³ /Ê‹aËr Éªs É¦É™t stÉ‘ËˆÊƒÉ”n/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ã“ã®åˆ—è»Šã¯ã‚¢ãƒ ã‚¹ãƒ†ãƒ«ãƒ€ãƒ è¡Œãã§ã™ã‹ï¼Ÿ</strong></td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Gaat deze trein naar Amsterdam?</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒãƒ¼ãƒˆ ãƒ‡ãƒ¼ã‚¼ ãƒˆãƒ©ã‚¤ãƒ³ ãƒŠãƒ¼ãƒ« ã‚¢ãƒ ã‚¹ãƒ†ãƒ«ãƒ€ãƒ  /É£aËt ËˆdeËzÉ™ trÉ›iÌ¯n naËr ËŒÉ‘mstÉ™rËˆdÉ‘m/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>åˆ‡ç¬¦ã‚’2æšãã ã•ã„ã€‚</strong></td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Mag ik twee kaartjes alstublieft?</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒãƒƒ ãƒ•ã‚£ãƒƒã‚¯ ãƒˆã‚¥ã‚¦ã‚§ãƒ¼ ã‚«ãƒ¼ãƒ«ãƒã‚§ã‚¹ ã‚¢ãƒ«ã‚¹ãƒˆãƒ¥ãƒ–ãƒªãƒ¼ãƒ•ãƒˆ /mÉ‘x Éªk tveË ËˆkaËr.cÉ™s ËŒÉ‘lstÊËˆblift/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</strong>ãƒ›ãƒ†ãƒ«ã§</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Ik wil graag inchecken.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ã‚¤ã‚¯ ãƒ´ã‚£ãƒ« ãƒ•ãƒ©ãƒ¼ãƒ• ã‚¤ãƒ³ãƒã‚§ãƒƒã‚±ãƒ³ /Éªk Ê‹Éªl É£raËx ËˆÉªnËŒtÊƒÉ›kÉ™(n)/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ãŠã™ã™ã‚ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</strong></td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Heeft u een aanbeveling voor een restaurant?</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ˜ãƒ¼ãƒ•ãƒˆã‚¥ãƒ¼ ã‚¦ãƒ³ ã‚¢ãƒ¼ãƒ³ãƒ™ãƒ¼ãƒ•ã‚§ã‚¤ãƒªãƒ³ã‚° ãƒ•ã‚©ãƒ¼ãƒ« ã‚¦ãƒ³ ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ /É¦eËft y Ên ËˆaËm.beËËŒveË.lÉªÅ‹ foËr Ên ËŒrÉ›stÉ”ËˆrÉ‘nt/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>åŠ©ã‘ãŒå¿…è¦ã§ã™ã€‚</strong>ç·Šæ€¥æ™‚</td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Ik heb hulp nodig.</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ã‚¤ã‚¯ ãƒ˜ãƒƒãƒ— ãƒ•ãƒ«ãƒ— ãƒãƒ¼ãƒ‡ã‚£ãƒ• /Éªk É¦É›b É¦Êlp ËˆnoËdÉªx/</td>
                </tr>
                <tr>
                  <td data-label="æ—¥æœ¬èª"><strong>ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ</strong></td>
                  <td data-label="ã‚ªãƒ©ãƒ³ãƒ€èª">Waar is het toilet?</td>
                  <td data-label="ã‚«ã‚¿ã‚«ãƒŠãƒ»ç™ºéŸ³ãƒ’ãƒ³ãƒˆ">ãƒ¯ãƒ¼ãƒ« ã‚¤ã‚¹ ãƒ˜ãƒƒãƒˆ ãƒˆãƒ¯ãƒ¬ãƒƒãƒˆ /Ê‹aËr Éªs É¦É™t twÉ‘ËˆlÉ›t/</td>
                </tr>
              </tbody>
            </table>
          </section>
        </section>

        <section
          id="mode-panel-game"
          class="mode-panel"
          role="tabpanel"
          aria-labelledby="mode-tab-game"
          data-mode-panel="game"
          hidden
          aria-hidden="true"
        >
          <section class="card game-section">
            <div class="game-intro">
              <h2>ãƒ•ãƒ¬ãƒ¼ã‚ºãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰</h2>
              <p>
                æ—¥æœ¬èªã‚«ãƒ¼ãƒ‰ã¨ã‚ªãƒ©ãƒ³ãƒ€èªã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã‚‹ã€ãƒ†ãƒ³ãƒã®è‰¯ã„ãƒãƒƒãƒãƒ³ã‚°ã‚²ãƒ¼ãƒ ã§ã™ã€‚è€³ã¨ç›®ã‚’åŒæ™‚ã«ä½¿ã„ãªãŒã‚‰ã€çŸ­æ™‚é–“ã§ä½•åº¦ã‚‚éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚
              </p>
            </div>
            <div class="game-meta">
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">Stage</span>
                <span class="meta-value"><span id="game-stage">0</span><small>æ®µ</small></span>
              </div>
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">Score</span>
                <span class="meta-value" id="game-score">0</span>
              </div>
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">é€£ç¶šæ­£è§£</span>
                <span class="meta-value"><span id="game-streak">0</span><small id="game-best">BEST 0</small></span>
              </div>
            </div>
            <div class="game-controls">
              <button id="game-start-button" class="game-button" type="button">ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å§‹ã‚ã‚‹</button>
              <button id="game-reset-button" class="game-button secondary" type="button">ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <p id="game-status" class="game-status" aria-live="polite">ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å§‹ã‚ã¦ã‚«ãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒã•ã›ã¾ã—ã‚‡ã†ï¼</p>
            <div
              id="game-grid"
              class="game-card-grid"
              aria-label="æ—¥æœ¬èªã¨ã‚ªãƒ©ãƒ³ãƒ€èªã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒã•ã›ã‚‹ã‚°ãƒªãƒƒãƒ‰"
              aria-live="polite"
            ></div>
          </section>
        </section>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2024 NederLingo. All rights reserved.
  </footer>

  <script>
    const PHRASE_DATA = [
      {
        id: 'greet-morning',
        category: 'greetings',
        ja: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚',
        nl: 'Goedemorgen.',
        hint: 'ãƒ•ãƒ¼ãƒ‡ãƒ¢ãƒ«ãƒ˜ãƒ³ /É£udÉ™ËˆmÉ”r.É£É™(n)/',
        featured: true,
      },
      {
        id: 'greet-day',
        category: 'greetings',
        ja: 'ã“ã‚“ã«ã¡ã¯ã€‚',
        nl: 'Goedemiddag.',
        hint: 'ãƒ•ãƒ¼ãƒ‡ãƒŸãƒ€ãƒ• /É£udÉ™ËˆmÉªdÉ‘x/',
      },
      {
        id: 'greet-evening',
        category: 'greetings',
        ja: 'ã“ã‚“ã°ã‚“ã¯ã€‚',
        nl: 'Goedenavond.',
        hint: 'ãƒ•ãƒ¼ãƒ‡ãƒŠãƒ¼ãƒ•ã‚©ãƒ³ãƒˆ /É£udÉ™ËˆnaËvÉ”nt/',
      },
      {
        id: 'greet-meet',
        category: 'greetings',
        ja: 'ã¯ã˜ã‚ã¾ã—ã¦ã€‚',
        nl: 'Aangenaam.',
        hint: 'ã‚¢ãƒ¼ãƒãƒŠãƒ¼ãƒ  /ËˆaËÅ‹É£É™naËm/',
      },
      {
        id: 'greet-bye',
        category: 'greetings',
        ja: 'ã•ã‚ˆã†ãªã‚‰ã€‚',
        nl: 'Tot ziens.',
        hint: 'ãƒˆãƒƒãƒ„ã‚£ãƒ³ã‚¹ /tÉ”t Ëˆzins/',
      },
      {
        id: 'greet-later',
        category: 'greetings',
        ja: 'ã¾ãŸå¾Œã§ã­ã€‚',
        nl: 'Tot later.',
        hint: 'ãƒˆãƒˆ ãƒ©ãƒ¼ãƒ†ãƒ« /tÉ”t ËˆlaËtÉ™r/',
      },
      {
        id: 'polite-thanks',
        category: 'essentials',
        ja: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚',
        nl: 'Dank u wel.',
        hint: 'ãƒ€ãƒ³ã‚¯ ã‚¦ ãƒ´ã‚§ãƒ« /dÉ‘Å‹k y Ê‹É›l/',
        featured: true,
      },
      {
        id: 'polite-sorry',
        category: 'essentials',
        ja: 'ã™ã¿ã¾ã›ã‚“ã€‚',
        nl: 'Pardon.',
        hint: 'ãƒ‘ãƒ«ãƒ‰ãƒ³ /ËˆpÉ‘r.dÉ”n/',
        featured: true,
      },
      {
        id: 'travel-station',
        category: 'travel',
        ja: 'é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
        nl: 'Waar is het station?',
        hint: 'ãƒ¯ãƒ¼ãƒ« ã‚¤ã‚¹ ãƒ˜ãƒƒãƒˆ ã‚¹ã‚¿ã‚·ã‚ªãƒ³ /Ê‹aËr Éªs É¦É™t stÉ‘ËˆÊƒÉ”n/',
        featured: true,
      },
      {
        id: 'travel-train',
        category: 'travel',
        ja: 'ã“ã®åˆ—è»Šã¯ã‚¢ãƒ ã‚¹ãƒ†ãƒ«ãƒ€ãƒ è¡Œãã§ã™ã‹ï¼Ÿ',
        nl: 'Gaat deze trein naar Amsterdam?',
        hint: 'ãƒãƒ¼ãƒˆ ãƒ‡ãƒ¼ã‚¼ ãƒˆãƒ©ã‚¤ãƒ³ ãƒŠãƒ¼ãƒ« ã‚¢ãƒ ã‚¹ãƒ†ãƒ«ãƒ€ãƒ  /É£aËt ËˆdeËzÉ™ trÉ›iÌ¯n naËr ËŒÉ‘mstÉ™rËˆdÉ‘m/',
      },
      {
        id: 'travel-ticket',
        category: 'travel',
        ja: 'åˆ‡ç¬¦ã‚’2æšãã ã•ã„ã€‚',
        nl: 'Mag ik twee kaartjes alstublieft?',
        hint: 'ãƒãƒƒ ãƒ•ã‚£ãƒƒã‚¯ ãƒˆã‚¥ã‚¦ã‚§ãƒ¼ ã‚«ãƒ¼ãƒ«ãƒã‚§ã‚¹ ã‚¢ãƒ«ã‚¹ãƒˆãƒ¥ãƒ–ãƒªãƒ¼ãƒ•ãƒˆ /mÉ‘x Éªk tveË ËˆkaËr.cÉ™s ËŒÉ‘lstÊËˆblift/',
      },
      {
        id: 'travel-checkin',
        category: 'travel',
        ja: 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚',
        nl: 'Ik wil graag inchecken.',
        hint: 'ã‚¤ã‚¯ ãƒ´ã‚£ãƒ« ãƒ•ãƒ©ãƒ¼ãƒ• ã‚¤ãƒ³ãƒã‚§ãƒƒã‚±ãƒ³ /Éªk Ê‹Éªl É£raËx ËˆÉªnËŒtÊƒÉ›kÉ™(n)/',
      },
      {
        id: 'travel-restaurant',
        category: 'travel',
        ja: 'ãŠã™ã™ã‚ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
        nl: 'Heeft u een aanbeveling voor een restaurant?',
        hint: 'ãƒ˜ãƒ¼ãƒ•ãƒˆã‚¥ãƒ¼ ã‚¦ãƒ³ ã‚¢ãƒ¼ãƒ³ãƒ™ãƒ¼ãƒ•ã‚§ã‚¤ãƒªãƒ³ã‚° ãƒ•ã‚©ãƒ¼ãƒ« ã‚¦ãƒ³ ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ /É¦eËft y Ên ËˆaËm.beËËŒveË.lÉªÅ‹ foËr Ên ËŒrÉ›stÉ”ËˆrÉ‘nt/',
      },
      {
        id: 'emergency-help',
        category: 'essentials',
        ja: 'åŠ©ã‘ãŒå¿…è¦ã§ã™ã€‚',
        nl: 'Ik heb hulp nodig.',
        hint: 'ã‚¤ã‚¯ ãƒ˜ãƒƒãƒ— ãƒ•ãƒ«ãƒ— ãƒãƒ¼ãƒ‡ã‚£ãƒ• /Éªk É¦É›b É¦Êlp ËˆnoËdÉªx/',
        featured: true,
      },
      {
        id: 'travel-restroom',
        category: 'travel',
        ja: 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
        nl: 'Waar is het toilet?',
        hint: 'ãƒ¯ãƒ¼ãƒ« ã‚¤ã‚¹ ãƒ˜ãƒƒãƒˆ ãƒˆãƒ¯ãƒ¬ãƒƒãƒˆ /Ê‹aËr Éªs É¦É™t twÉ‘ËˆlÉ›t/',
      },
    ];

    const PHRASE_LOOKUP = new Map(PHRASE_DATA.map((phrase) => [phrase.id, phrase]));

    const shuffleArray = (input) => {
      const array = [...input];

      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }

      return array;
    };

    const phraseListElement = document.querySelector('[data-phrase-list]');

    const renderStudyList = () => {
      if (!phraseListElement) {
        return;
      }

      phraseListElement.innerHTML = '';

      const featuredPhrases = PHRASE_DATA.filter((phrase) => phrase.featured);
      const fragment = document.createDocumentFragment();

      featuredPhrases.forEach((phrase) => {
        const item = document.createElement('li');
        item.dataset.phraseId = phrase.id;

        const original = document.createElement('span');
        original.className = 'phrase-original';
        original.textContent = phrase.ja;

        const translation = document.createElement('span');
        translation.className = 'phrase-translation is-hidden';
        translation.textContent = phrase.nl;

        const speakButton = document.createElement('button');
        speakButton.type = 'button';
        speakButton.className = 'speak-phrase speak-control';
        speakButton.dataset.speech = phrase.nl;
        speakButton.dataset.defaultLabel = 'å†ç”Ÿ';
        speakButton.dataset.activeLabel = 'å†ç”Ÿä¸­â€¦';
        speakButton.setAttribute('aria-label', `${phrase.ja} ã‚’ã‚ªãƒ©ãƒ³ãƒ€èªã§å†ç”Ÿ`);
        speakButton.textContent = 'å†ç”Ÿ';

        const recognizeButton = document.createElement('button');
        recognizeButton.type = 'button';
        recognizeButton.className = 'recognize-phrase';
        recognizeButton.dataset.target = phrase.nl;
        recognizeButton.setAttribute('aria-label', `${phrase.nl} ã‚’ç™ºéŸ³ã—ã¦ã¿ã‚ˆã†`);
        recognizeButton.textContent = 'ç™ºå£°ãƒ†ã‚¹ãƒˆ';

        const toggleButton = document.createElement('button');
        toggleButton.type = 'button';
        toggleButton.className = 'toggle-translation';
        toggleButton.textContent = 'è¨³ã‚’è¡¨ç¤º';

        toggleButton.addEventListener('click', () => {
          translation.classList.toggle('is-hidden');
          toggleButton.textContent = translation.classList.contains('is-hidden')
            ? 'è¨³ã‚’è¡¨ç¤º'
            : 'è¨³ã‚’éš ã™';
        });

        item.append(original, translation, speakButton, recognizeButton, toggleButton);
        fragment.appendChild(item);
      });

      phraseListElement.appendChild(fragment);
    };

    renderStudyList();

    const modeContainer = document.querySelector('.main-container');
    const modeButtons = modeContainer
      ? Array.from(modeContainer.querySelectorAll('[data-mode]'))
      : [];
    const modePanels = modeContainer
      ? Array.from(modeContainer.querySelectorAll('[data-mode-panel]'))
      : [];

    if (modeContainer && modeButtons.length > 0 && modePanels.length > 0) {
      const setActiveMode = (mode) => {
        modeContainer.dataset.activeMode = mode;

        modeButtons.forEach((button) => {
          const targetMode = button.getAttribute('data-mode');
          const isActive = targetMode === mode;

          button.setAttribute('aria-selected', String(isActive));
          button.setAttribute('tabindex', isActive ? '0' : '-1');
        });

        modePanels.forEach((panel) => {
          const panelMode = panel.getAttribute('data-mode-panel');
          const isActive = panelMode === mode;

          panel.toggleAttribute('hidden', !isActive);
          panel.setAttribute('aria-hidden', String(!isActive));
        });
      };

      const availableModes = modeButtons
        .map((button) => button.getAttribute('data-mode'))
        .filter((value) => typeof value === 'string' && value.length > 0);

      let initialMode = modeContainer.dataset.activeMode;

      if (!initialMode || !availableModes.includes(initialMode)) {
        initialMode = availableModes[0];
      }

      setActiveMode(initialMode);

      modeButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const mode = button.getAttribute('data-mode');

          if (!mode) {
            return;
          }

          setActiveMode(mode);
        });

        button.addEventListener('keydown', (event) => {
          const currentIndex = modeButtons.indexOf(button);
          let targetIndex = null;

          if (event.key === 'ArrowRight' || event.key === 'ArrowDown') {
            targetIndex = (currentIndex + 1) % modeButtons.length;
          } else if (event.key === 'ArrowLeft' || event.key === 'ArrowUp') {
            targetIndex =
              (currentIndex - 1 + modeButtons.length) % modeButtons.length;
          } else if (event.key === 'Home') {
            targetIndex = 0;
          } else if (event.key === 'End') {
            targetIndex = modeButtons.length - 1;
          }

          if (targetIndex !== null) {
            event.preventDefault();

            const targetButton = modeButtons[targetIndex];
            const mode = targetButton?.getAttribute('data-mode');

            if (mode) {
              setActiveMode(mode);
              targetButton.focus();
            }
          }
        });
      });
    }

    const rateSlider = document.getElementById('speech-rate');
    const rateValue = document.getElementById('speech-rate-value');

    if (rateSlider && rateValue) {
      const updateRateLabel = () => {
        rateValue.textContent = `${parseFloat(rateSlider.value).toFixed(1)}x`;
      };

      rateSlider.addEventListener('input', updateRateLabel);
      updateRateLabel();
    }

    if ('speechSynthesis' in window) {
      const synthesis = window.speechSynthesis;
      let availableVoices = [];
      let activeButton = null;

      const refreshVoices = () => {
        availableVoices = synthesis
          .getVoices()
          .filter((voice) => voice.lang && voice.lang.toLowerCase().startsWith('nl'));

        if (availableVoices.length === 0) {
          availableVoices = synthesis.getVoices();
        }
      };

      const resetActiveButton = () => {
        if (activeButton) {
          activeButton.disabled = false;
          const defaultLabel = activeButton.dataset.defaultLabel ?? 'å†ç”Ÿ';
          activeButton.textContent = defaultLabel;
          activeButton = null;
        }
      };

      const speakFromButton = (button) => {
        const dutchText = button.dataset.speech?.trim();

        if (!dutchText) {
          return;
        }

        if (!button.dataset.defaultLabel) {
          button.dataset.defaultLabel = button.textContent;
        }

        if (synthesis.speaking || synthesis.pending) {
          synthesis.cancel();
        }

        resetActiveButton();

        const utterance = new SpeechSynthesisUtterance(dutchText);
        utterance.lang = 'nl-NL';

        if (rateSlider) {
          utterance.rate = parseFloat(rateSlider.value) || 1;
        }

        const selectedVoice = availableVoices.find(
          (voice) => voice.lang && voice.lang.toLowerCase().startsWith('nl')
        );

        if (selectedVoice) {
          utterance.voice = selectedVoice;
        }

        utterance.onend = () => {
          if (activeButton === button) {
            button.disabled = false;
            button.textContent = button.dataset.defaultLabel ?? 'å†ç”Ÿ';
            activeButton = null;
          }
        };

        utterance.onerror = () => {
          if (activeButton === button) {
            button.disabled = false;
            button.textContent = button.dataset.defaultLabel ?? 'å†ç”Ÿ';
            activeButton = null;
          }
        };

        activeButton = button;
        button.disabled = true;
        button.textContent = button.dataset.activeLabel ?? 'å†ç”Ÿä¸­â€¦';

        synthesis.speak(utterance);
      };

      const handleSpeakClick = (event) => {
        const button = event.target.closest('.speak-control');

        if (!button) {
          return;
        }

        event.preventDefault();
        event.stopPropagation();

        if (availableVoices.length === 0) {
          refreshVoices();
        }

        speakFromButton(button);
      };

      refreshVoices();
      synthesis.addEventListener('voiceschanged', refreshVoices);
      document.addEventListener('click', handleSpeakClick);
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognitionNotice = document.getElementById('speech-recognition-notice');
    const recognitionPanel = document.getElementById('recognition-panel');
    const recognitionStatus = document.getElementById('recognition-status');
    const recognitionTarget = document.getElementById('recognition-target');
    const recognitionText = document.getElementById('recognition-text');
    const recognitionScore = document.getElementById('recognition-score');

    const defaultStatusMessage = 'ãƒã‚¤ã‚¯ã®è¨±å¯ã‚’ä¸ãˆã¦ã€Œç™ºå£°ãƒ†ã‚¹ãƒˆã€ã‚’æŠ¼ã™ã¨ç™ºéŸ³ãƒã‚§ãƒƒã‚¯ãŒã§ãã¾ã™ã€‚';

    const sanitizePhrase = (text) =>
      text
        .toLowerCase()
        .replace(/[^a-zÃ -Å¾\s']/gi, ' ')
        .replace(/\s+/g, ' ')
        .trim();

    const computeSimilarity = (a, b) => {
      const source = sanitizePhrase(a);
      const target = sanitizePhrase(b);

      if (!source && !target) {
        return 1;
      }

      if (!source || !target) {
        return 0;
      }

      const rows = source.length + 1;
      const cols = target.length + 1;
      const dp = Array.from({ length: rows }, () => new Array(cols).fill(0));

      for (let i = 0; i < rows; i += 1) {
        dp[i][0] = i;
      }

      for (let j = 0; j < cols; j += 1) {
        dp[0][j] = j;
      }

      for (let i = 1; i < rows; i += 1) {
        for (let j = 1; j < cols; j += 1) {
          const cost = source[i - 1] === target[j - 1] ? 0 : 1;
          dp[i][j] = Math.min(
            dp[i - 1][j] + 1,
            dp[i][j - 1] + 1,
            dp[i - 1][j - 1] + cost
          );
        }
      }

      const distance = dp[rows - 1][cols - 1];
      const longest = Math.max(source.length, target.length);

      return longest === 0 ? 1 : 1 - distance / longest;
    };

    if (
      recognitionNotice &&
      recognitionPanel &&
      recognitionStatus &&
      recognitionTarget &&
      recognitionText &&
      recognitionScore
    ) {
      if (!SpeechRecognition) {
        recognitionNotice.textContent =
          'ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeãªã©ã®å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ãŠè©¦ã—ãã ã•ã„ã€‚';
        recognitionNotice.classList.remove('is-hidden');
        recognitionPanel.classList.add('is-hidden');
      } else {
        recognitionPanel.classList.remove('is-hidden');
        recognitionNotice.textContent = 'åˆå›åˆ©ç”¨æ™‚ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ã‚¯è¨±å¯ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚';
        recognitionNotice.classList.remove('is-hidden');
        recognitionStatus.textContent = defaultStatusMessage;

        const recognition = new SpeechRecognition();
        recognition.lang = 'nl-NL';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        let activeRecognitionButton = null;
        let targetPhrase = '';

        const releaseRecognitionButton = () => {
          if (activeRecognitionButton) {
            activeRecognitionButton.disabled = false;
            activeRecognitionButton.textContent = 'ç™ºå£°ãƒ†ã‚¹ãƒˆ';
            activeRecognitionButton = null;
          }
        };

        recognition.addEventListener('start', () => {
          recognitionStatus.textContent = 'éŒ²éŸ³ä¸­ã§ã™ã€‚è©±ã—çµ‚ãˆãŸã‚‰è‡ªå‹•çš„ã«åˆ¤å®šã—ã¾ã™ã€‚';
        });

        recognition.addEventListener('result', (event) => {
          const transcript = event.results[0][0]?.transcript?.trim() ?? '';
          recognitionText.textContent = transcript || '-';
          recognitionTarget.textContent = targetPhrase || '-';

          const similarity = computeSimilarity(transcript, targetPhrase);
          const percentage = Math.round(similarity * 100);
          recognitionScore.textContent = Number.isNaN(percentage) ? '-' : `${percentage}%`;
        });

        recognition.addEventListener('error', (event) => {
          recognitionStatus.textContent = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${event.error}`;
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';
          releaseRecognitionButton();
        });

        recognition.addEventListener('nomatch', () => {
          recognitionStatus.textContent = 'éŸ³å£°ã‚’èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';
        });

        recognition.addEventListener('end', () => {
          releaseRecognitionButton();

          if (recognitionStatus.textContent.startsWith('éŒ²éŸ³ä¸­ã§ã™')) {
            recognitionStatus.textContent = defaultStatusMessage;
          }
        });

        const handleRecognitionClick = (event) => {
          const button = event.target.closest('.recognize-phrase');

          if (!button) {
            return;
          }

          event.preventDefault();
          event.stopPropagation();

          const dutchText = button.dataset.target?.trim();

          if (!dutchText) {
            return;
          }

          if (activeRecognitionButton) {
            try {
              recognition.abort();
            } catch (error) {
              /* noop */
            }
            releaseRecognitionButton();
          }

          targetPhrase = dutchText;
          recognitionTarget.textContent = dutchText;
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';

          activeRecognitionButton = button;
          button.disabled = true;
          button.textContent = 'éŒ²éŸ³ä¸­â€¦';

          try {
            recognition.start();
          } catch (error) {
            recognitionStatus.textContent =
              'éŸ³å£°èªè­˜ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
            releaseRecognitionButton();
            targetPhrase = '';
            recognitionTarget.textContent = '-';
            recognitionText.textContent = '-';
            recognitionScore.textContent = '-';
          }
        };

        document.addEventListener('click', handleRecognitionClick);

        window.addEventListener('beforeunload', () => {
          try {
            recognition.stop();
          } catch (error) {
            /* noop */
          }
        });
      }
    }

    const gameGrid = document.getElementById('game-grid');
    const gameStatus = document.getElementById('game-status');
    const stageDisplay = document.getElementById('game-stage');
    const scoreDisplay = document.getElementById('game-score');
    const streakDisplay = document.getElementById('game-streak');
    const bestDisplay = document.getElementById('game-best');
    const startButton = document.getElementById('game-start-button');
    const resetButton = document.getElementById('game-reset-button');

    const gameState = {
      stage: 0,
      score: 0,
      streak: 0,
      best: 0,
      matchesRemaining: 0,
      selection: [],
      busy: false,
    };

    const pulseElement = (element) => {
      if (!element) {
        return;
      }

      element.classList.remove('score-pulse');
      void element.offsetWidth;
      element.classList.add('score-pulse');
    };

    const stagePairCount = (stageNumber) =>
      Math.min(3 + stageNumber, Math.min(6, PHRASE_DATA.length));

    const setStatus = (message) => {
      if (gameStatus) {
        gameStatus.textContent = message;
      }
    };

    const updateScoreboard = () => {
      if (stageDisplay) {
        stageDisplay.textContent = gameState.stage;
      }

      if (scoreDisplay) {
        scoreDisplay.textContent = gameState.score;
      }

      if (streakDisplay) {
        streakDisplay.textContent = gameState.streak;
      }

      if (bestDisplay) {
        bestDisplay.textContent = `BEST ${gameState.best}`;
      }
    };

    const buildHintMessage = (phrase, lang) => {
      if (!phrase) {
        return '';
      }

      if (lang === 'ja') {
        let hint = `ã‚ªãƒ©ãƒ³ãƒ€èª: ${phrase.nl}`;

        if (phrase.hint) {
          hint += `\nç™ºéŸ³ãƒ’ãƒ³ãƒˆ: ${phrase.hint}`;
        }

        return hint;
      }

      let hint = `æ—¥æœ¬èª: ${phrase.ja}`;

      if (phrase.hint) {
        hint += `\nç™ºéŸ³ãƒ’ãƒ³ãƒˆ: ${phrase.hint}`;
      }

      return hint;
    };

    const createGameCard = (phrase, lang) => {
      const card = document.createElement('div');
      card.className = 'game-card';
      card.dataset.pairId = phrase.id;
      card.dataset.lang = lang;

      const mainButton = document.createElement('button');
      mainButton.type = 'button';
      mainButton.className = 'game-card-main';

      const labelText = lang === 'ja' ? 'æ—¥æœ¬èª' : 'ã‚ªãƒ©ãƒ³ãƒ€èª';
      const displayText = lang === 'ja' ? phrase.ja : phrase.nl;
      mainButton.setAttribute('aria-label', `${labelText}ã‚«ãƒ¼ãƒ‰: ${displayText}`);

      const textSpan = document.createElement('span');
      textSpan.className = 'game-card-text';
      textSpan.textContent = displayText;

      const labelSpan = document.createElement('span');
      labelSpan.className = 'game-card-label';
      labelSpan.textContent = labelText;

      mainButton.append(textSpan, labelSpan);

      const actions = document.createElement('div');
      actions.className = 'game-card-actions';

      const speakButton = document.createElement('button');
      speakButton.type = 'button';
      speakButton.className = 'card-action speak-control';
      speakButton.dataset.speech = phrase.nl;
      speakButton.dataset.defaultLabel = 'ğŸ”Š';
      speakButton.dataset.activeLabel = 'ğŸ”„';
      speakButton.setAttribute('aria-label', `${phrase.ja} ã®ã‚ªãƒ©ãƒ³ãƒ€èªã‚’å†ç”Ÿ`);
      speakButton.textContent = 'ğŸ”Š';

      const hintButton = document.createElement('button');
      hintButton.type = 'button';
      hintButton.className = 'card-action card-hint';
      hintButton.setAttribute('aria-expanded', 'false');
      hintButton.textContent = 'ãƒ’ãƒ³ãƒˆ';

      actions.append(speakButton, hintButton);

      const hintText = document.createElement('p');
      hintText.className = 'game-card-hint';
      hintText.hidden = true;

      card.append(mainButton, actions, hintText);

      return card;
    };

    const resetGame = (announce = true) => {
      gameState.stage = 0;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.best = 0;
      gameState.matchesRemaining = 0;
      gameState.selection = [];
      gameState.busy = false;
      updateScoreboard();

      if (gameGrid) {
        gameGrid.innerHTML = '';
      }

      if (startButton) {
        startButton.disabled = false;
        startButton.textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å§‹ã‚ã‚‹';
      }

      if (announce) {
        setStatus('ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å§‹ã‚ã¦ã‚«ãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒã•ã›ã¾ã—ã‚‡ã†ï¼');
      }
    };

    const stageClearFeedback = () => {
      const bonus = 20;
      gameState.score += bonus;
      updateScoreboard();
      pulseElement(scoreDisplay);

      if (startButton) {
        startButton.disabled = false;
        startButton.textContent = 'æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸';
      }

      setStatus(`âœ¨ ã‚¹ãƒ†ãƒ¼ã‚¸${gameState.stage}ã‚¯ãƒªã‚¢ï¼ãƒœãƒ¼ãƒŠã‚¹${bonus}ç‚¹ã‚’ç²å¾—ã—ãŸã‚ˆã€‚`);
    };

    const evaluateSelection = () => {
      if (gameState.selection.length < 2) {
        return;
      }

      gameState.busy = true;

      const [first, second] = gameState.selection;
      const isMatch = first.pairId === second.pairId && first.lang !== second.lang;

      if (isMatch) {
        const phrase = PHRASE_LOOKUP.get(first.pairId);
        [first.card, second.card].forEach((card) => {
          card.classList.remove('is-selected');
          card.classList.add('is-matched', 'is-disabled');
        });

        gameState.matchesRemaining -= 1;
        gameState.streak += 1;

        if (gameState.streak > gameState.best) {
          gameState.best = gameState.streak;
        }

        const gained = 10 + gameState.streak * 2;
        gameState.score += gained;
        updateScoreboard();
        pulseElement(scoreDisplay);
        pulseElement(streakDisplay);

        if (phrase) {
          setStatus(`ğŸ‰ æ­£è§£ï¼ã€Œ${phrase.ja}ã€ã¨ã€Œ${phrase.nl}ã€ã§${gained}ç‚¹ã‚²ãƒƒãƒˆï¼`);
        } else {
          setStatus('ğŸ‰ æ­£è§£ï¼ã™ã°ã‚‰ã—ã„ï¼');
        }

        gameState.selection = [];
        gameState.busy = false;

        if (gameState.matchesRemaining === 0) {
          stageClearFeedback();
        }

        return;
      }

      gameState.streak = 0;
      updateScoreboard();
      pulseElement(streakDisplay);
      setStatus('ã‚ã‚Œï¼Ÿé•ã†ã¿ãŸã„ã€‚è½ã¡ç€ã„ã¦ã‚‚ã†ä¸€åº¦ï¼');

      const [firstCard, secondCard] = [first.card, second.card];

      setTimeout(() => {
        firstCard.classList.remove('is-selected');
        secondCard.classList.remove('is-selected');
        gameState.selection = [];
        gameState.busy = false;
      }, 700);
    };

    const handleCardSelection = (card) => {
      if (!card || gameState.busy) {
        return;
      }

      if (card.classList.contains('is-matched') || card.classList.contains('is-disabled')) {
        return;
      }

      const pairId = card.getAttribute('data-pair-id');
      const lang = card.getAttribute('data-lang');

      if (!pairId || !lang) {
        return;
      }

      if (gameState.selection.length === 0) {
        gameState.selection.push({ card, pairId, lang });
        card.classList.add('is-selected');
        setStatus('ã‚‚ã†1æšé¸ã‚“ã§ãƒšã‚¢ã‚’ä½œã‚ã†ï¼');
        return;
      }

      const [firstSelection] = gameState.selection;

      if (firstSelection.card === card) {
        card.classList.remove('is-selected');
        gameState.selection = [];
        setStatus('ã‚«ãƒ¼ãƒ‰ã‚’é¸ã³ç›´ã—ãŸã‚ˆã€‚');
        return;
      }

      if (firstSelection.lang === lang) {
        firstSelection.card.classList.remove('is-selected');
        gameState.selection = [{ card, pairId, lang }];
        card.classList.add('is-selected');
        setStatus('ã‚‚ã†1æšé¸ã‚“ã§ãƒšã‚¢ã‚’ä½œã‚ã†ï¼');
        return;
      }

      gameState.selection.push({ card, pairId, lang });
      card.classList.add('is-selected');
      evaluateSelection();
    };

    const startStage = () => {
      if (!gameGrid) {
        return;
      }

      const nextStage = gameState.stage + 1;
      const pairCount = stagePairCount(nextStage);

      if (pairCount <= 0) {
        setStatus('åˆ©ç”¨ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }

      const selectedPairs = shuffleArray(PHRASE_DATA).slice(0, pairCount);
      const cards = shuffleArray(
        selectedPairs.flatMap((phrase) => [
          { phrase, lang: 'ja' },
          { phrase, lang: 'nl' },
        ])
      );

      gameGrid.setAttribute('aria-busy', 'true');
      gameGrid.innerHTML = '';

      const fragment = document.createDocumentFragment();
      cards.forEach(({ phrase, lang }) => {
        fragment.appendChild(createGameCard(phrase, lang));
      });

      gameGrid.appendChild(fragment);
      gameGrid.removeAttribute('aria-busy');

      gameState.stage = nextStage;
      gameState.matchesRemaining = selectedPairs.length;
      gameState.selection = [];
      gameState.busy = false;

      if (startButton) {
        startButton.disabled = true;
        startButton.textContent = 'ãƒ—ãƒ¬ã‚¤ä¸­â€¦';
      }

      updateScoreboard();
      setStatus(`ã‚¹ãƒ†ãƒ¼ã‚¸${gameState.stage}ã‚¹ã‚¿ãƒ¼ãƒˆï¼åŒã˜æ„å‘³ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã­ã€‚`);
    };

    if (gameGrid) {
      gameGrid.addEventListener('click', (event) => {
        const hintButton = event.target.closest('.card-hint');

        if (hintButton) {
          event.preventDefault();
          event.stopPropagation();

          const card = hintButton.closest('.game-card');
          const pairId = card?.getAttribute('data-pair-id');
          const lang = card?.getAttribute('data-lang');

          if (!card || !pairId || !lang) {
            return;
          }

          const phrase = PHRASE_LOOKUP.get(pairId);
          const hintArea = card.querySelector('.game-card-hint');

          if (!phrase || !hintArea) {
            return;
          }

          const willShow = hintArea.hidden;

          if (willShow) {
            hintArea.textContent = buildHintMessage(phrase, lang);
          }

          hintArea.hidden = !willShow;
          hintButton.textContent = willShow ? 'ãƒ’ãƒ³ãƒˆã‚’ã¨ã˜ã‚‹' : 'ãƒ’ãƒ³ãƒˆ';
          hintButton.setAttribute('aria-expanded', String(willShow));
          setStatus(willShow ? 'ãƒ’ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦ãƒšã‚¢ã‚’æ¢ã—ã¦ã¿ã‚ˆã†ï¼' : 'ãƒ’ãƒ³ãƒˆã‚’é–‰ã˜ã¾ã—ãŸã€‚');

          return;
        }

        const mainButton = event.target.closest('.game-card-main');

        if (mainButton) {
          event.preventDefault();
          const card = mainButton.closest('.game-card');
          handleCardSelection(card);
        }
      });
    }

    if (startButton) {
      startButton.addEventListener('click', () => {
        if (startButton.disabled) {
          return;
        }

        startStage();
      });
    }

    if (resetButton) {
      resetButton.addEventListener('click', () => {
        resetGame();
        if (startButton) {
          startButton.focus();
        }
      });
    }

    resetGame();
  </script>

</body>
</html>
