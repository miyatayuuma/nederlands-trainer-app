<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NederLingo | 日本語⇔オランダ語フレーズ学習</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f7f7fb;
      --fg: #1f2933;
      --accent: #ff7a59;
      --accent-dark: #c24e31;
      --card-bg: #ffffff;
      --muted: #5f6c7b;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f172a;
        --fg: #e2e8f0;
        --card-bg: #16203a;
        --muted: #8ea4c4;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 24px 20px 16px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      letter-spacing: 0.04em;
    }

    header p {
      margin: 12px auto 0;
      max-width: 720px;
      font-size: 1rem;
      color: var(--muted);
      line-height: 1.6;
    }

    main {
      flex: 1;
      width: min(960px, 92vw);
      margin: 0 auto 48px;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .mode-switcher {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .mode-button {
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 51, 0.12);
      background: rgba(31, 41, 51, 0.04);
      color: inherit;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, border 0.2s ease-in-out, color 0.2s ease-in-out;
    }

    .mode-button:hover,
    .mode-button:focus-visible {
      background: rgba(31, 41, 51, 0.08);
      border-color: rgba(31, 41, 51, 0.24);
      outline: none;
    }

    .mode-button[aria-selected="true"] {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
    }

    .mode-panel-group {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .mode-panel {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(15, 23, 42, 0.05);
    }

    .setup-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .setup-list li {
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(255, 122, 89, 0.08);
      border: 1px dashed rgba(255, 122, 89, 0.4);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .phrase-list {
      list-style: none;
      margin: 24px 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .phrase-list li {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      align-items: center;
      font-size: 1rem;
      line-height: 1.8;
    }

    .phrase-original {
      font-weight: 600;
    }

    .phrase-translation {
      color: var(--muted);
    }

    .toggle-translation {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: white;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }

    .toggle-translation:hover,
    .toggle-translation:focus {
      background: var(--accent-dark);
    }

    .toggle-translation:focus {
      outline: 2px solid rgba(255, 122, 89, 0.3);
      outline-offset: 2px;
    }

    .speak-phrase,
    .recognize-phrase {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      background: rgba(31, 41, 51, 0.1);
      color: var(--fg);
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, color 0.2s ease-in-out;
    }

    .speak-phrase:hover,
    .speak-phrase:focus,
    .recognize-phrase:hover,
    .recognize-phrase:focus {
      background: rgba(31, 41, 51, 0.18);
    }

    .speak-phrase:disabled,
    .recognize-phrase:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .recognition-panel {
      border-radius: 16px;
      background: rgba(31, 41, 51, 0.06);
      padding: 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.9rem;
    }

    .recognition-panel strong {
      font-weight: 600;
      color: var(--fg);
    }

    .recognition-panel span {
      word-break: break-word;
    }

    .recognition-notice {
      margin-top: 12px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .speech-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .speech-controls input[type="range"] {
      accent-color: var(--accent);
    }

    .is-hidden {
      visibility: hidden;
    }

    .phrase-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .phrase-section h3 {
      margin: 0;
      font-size: 1.35rem;
    }

    .game-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .game-intro p {
      margin: 0;
      line-height: 1.6;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .game-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      align-items: center;
    }

    .game-meta .meta-box {
      border-radius: 14px;
      background: rgba(31, 41, 51, 0.06);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .meta-label {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .meta-value {
      font-size: 1.35rem;
      font-weight: 700;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .meta-value small {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--muted);
    }

    .game-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .game-button {
      padding: 10px 18px;
      border-radius: 12px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
      background: var(--accent);
      color: #ffffff;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .game-button:hover,
    .game-button:focus-visible {
      background: var(--accent-dark);
      transform: translateY(-1px);
      outline: none;
    }

    .game-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .game-button.secondary {
      background: rgba(31, 41, 51, 0.08);
      color: var(--fg);
    }

    .game-status {
      min-height: 1.4em;
      font-size: 0.95rem;
      color: var(--fg);
    }

    .game-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    .game-card {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border-radius: 18px;
      padding: 16px;
      background: var(--card-bg);
      border: 2px solid transparent;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.1);
      transition: transform 0.18s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .game-card[data-lang="ja"] {
      background: linear-gradient(135deg, rgba(255, 225, 215, 0.45), rgba(255, 255, 255, 0.8));
    }

    .game-card[data-lang="nl"] {
      background: linear-gradient(135deg, rgba(210, 230, 255, 0.4), rgba(255, 255, 255, 0.85));
    }

    .game-card-main {
      border: none;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 14px;
      padding: 16px;
      font-size: 1.05rem;
      font-weight: 600;
      text-align: center;
      color: var(--fg);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .game-card[data-lang="nl"] .game-card-main {
      font-size: 1rem;
    }

    .game-card-main:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .game-card-label {
      display: block;
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    .game-card-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .card-action {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      background: rgba(31, 41, 51, 0.12);
      color: var(--fg);
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.15s ease;
    }

    .card-action:hover,
    .card-action:focus-visible {
      background: rgba(31, 41, 51, 0.2);
      outline: none;
      transform: translateY(-1px);
    }

    .card-action:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .game-card-hint {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
      white-space: pre-wrap;
      text-align: center;
      min-height: 1.3em;
    }

    .game-card.is-selected {
      border-color: var(--accent);
      transform: translateY(-4px);
    }

    .game-card.is-matched {
      border-color: var(--accent);
      animation: cardMatch 520ms ease;
      box-shadow: 0 16px 32px rgba(255, 122, 89, 0.32);
    }

    .game-card.is-disabled {
      pointer-events: none;
      opacity: 0.6;
    }

    .score-pulse {
      animation: scorePulse 420ms ease;
    }

    @keyframes scorePulse {
      0% {
        transform: scale(1);
      }

      40% {
        transform: scale(1.15);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes cardMatch {
      0% {
        transform: scale(0.96);
      }

      60% {
        transform: scale(1.08);
      }

      100% {
        transform: scale(1);
      }
    }

    .phrase-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      background: rgba(255, 255, 255, 0.02);
    }

    .phrase-table th,
    .phrase-table td {
      padding: 12px 14px;
      border-bottom: 1px solid rgba(96, 110, 133, 0.18);
      text-align: left;
      vertical-align: top;
    }

    .phrase-table thead th {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .phrase-table tbody tr:last-child td {
      border-bottom: none;
    }

    .phrase-table td strong {
      display: block;
      font-size: 1rem;
    }

    @media (max-width: 640px) {
      .game-meta {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .game-card-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 14px;
      }

      .game-card {
        padding: 14px;
      }

      .game-card-main {
        font-size: 1.1rem;
        padding: 18px 12px;
      }

      .card-action {
        font-size: 0.9rem;
        padding: 7px 14px;
      }

      .phrase-table thead {
        display: none;
      }

      .phrase-table,
      .phrase-table tbody,
      .phrase-table tr,
      .phrase-table td {
        display: block;
        width: 100%;
      }

      .phrase-table tr {
        padding: 12px 0;
        border-bottom: 1px solid rgba(96, 110, 133, 0.18);
      }

      .phrase-table tbody tr:last-child {
        border-bottom: none;
      }

      .phrase-table td {
        border: none;
        padding: 6px 0;
      }

      .phrase-table td::before {
        content: attr(data-label);
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
        margin-bottom: 4px;
      }
    }

    @media (max-width: 480px) {
      .game-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .game-card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }

      .game-card {
        padding: 12px;
      }

      .game-card-main {
        font-size: 1.2rem;
      }

      .game-card-actions {
        gap: 6px;
      }
    }

    [hidden] {
      display: none !important;
    }

    footer {
      text-align: center;
      padding: 24px 16px 32px;
      font-size: 0.85rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <h1>NederLingo</h1>
    <p>
      日本語とオランダ語のフレーズ練習を、目的に合わせて切り替えられるマルチモード学習体験にアップデートしました。
    </p>
    <p>
      落ち着いて発音や意味を確認できる「フレーズ学習モード」と、今後公開予定の対戦要素を備えた「フレーズチャレンジモード」を切り替えて、自分に合ったリズムで学びましょう。
    </p>
  </header>

  <main>
    <div class="main-container" data-active-mode="study">
      <div class="mode-switcher" role="tablist" aria-label="学習モードの選択">
        <button
          id="mode-tab-study"
          class="mode-button"
          type="button"
          role="tab"
          aria-controls="mode-panel-study"
          aria-selected="true"
          data-mode="study"
        >
          フレーズ学習モード
        </button>
        <button
          id="mode-tab-game"
          class="mode-button"
          type="button"
          role="tab"
          aria-controls="mode-panel-game"
          aria-selected="false"
          tabindex="-1"
          data-mode="game"
        >
          フレーズチャレンジモード
        </button>
      </div>

      <div class="mode-panel-group">
        <section
          id="mode-panel-study"
          class="mode-panel"
          role="tabpanel"
          aria-labelledby="mode-tab-study"
          aria-hidden="false"
          data-mode-panel="study"
        >
          <section class="card">
            <h2>次のステップ</h2>
            <ul class="setup-list">
              <li>日本語⇔オランダ語のフレーズデータを整備する</li>
              <li>カテゴリ別に閲覧・練習できるUIを設計する</li>
              <li>検索や発音サポートなどの機能を検討する</li>
            </ul>
          </section>

          <section class="card">
            <h2>日常フレーズ集</h2>
            <div class="speech-controls">
              <label for="speech-rate">再生速度: <span id="speech-rate-value">1.0x</span></label>
              <input type="range" id="speech-rate" name="speech-rate" min="0.6" max="1.4" step="0.1" value="1">
            </div>
            <ul class="phrase-list" data-phrase-list></ul>
            <div id="recognition-panel" class="recognition-panel is-hidden" aria-live="polite">
              <p class="recognition-status"><strong>状態:</strong> <span id="recognition-status">マイクの許可を与えて「発声テスト」を押すと発音チェックができます。</span></p>
              <p class="recognition-target"><strong>目標フレーズ:</strong> <span id="recognition-target">-</span></p>
              <p class="recognition-result"><strong>認識結果:</strong> <span id="recognition-text">-</span></p>
              <p class="recognition-score"><strong>マッチ率:</strong> <span id="recognition-score">-</span></p>
            </div>
            <p id="speech-recognition-notice" class="recognition-notice is-hidden" aria-live="polite"></p>
          </section>

          <section class="card phrase-section">
            <h3>挨拶</h3>
            <table class="phrase-table">
              <thead>
                <tr>
                  <th scope="col">日本語</th>
                  <th scope="col">オランダ語</th>
                  <th scope="col">カタカナ・発音ヒント</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="日本語"><strong>おはようございます。</strong>丁寧な朝の挨拶</td>
                  <td data-label="オランダ語">Goedemorgen.</td>
                  <td data-label="カタカナ・発音ヒント">フーデモルヘン /ɣudəˈmɔr.ɣə(n)/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>こんにちは。</strong>日中の挨拶</td>
                  <td data-label="オランダ語">Goedemiddag.</td>
                  <td data-label="カタカナ・発音ヒント">フーデミダフ /ɣudəˈmɪdɑx/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>こんばんは。</strong>夕方以降の挨拶</td>
                  <td data-label="オランダ語">Goedenavond.</td>
                  <td data-label="カタカナ・発音ヒント">フーデナーフォント /ɣudəˈnaːvɔnt/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>はじめまして。</strong>初対面の挨拶</td>
                  <td data-label="オランダ語">Aangenaam.</td>
                  <td data-label="カタカナ・発音ヒント">アーネナーム /ˈaːŋɣənaːm/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>さようなら。</strong>別れの挨拶</td>
                  <td data-label="オランダ語">Tot ziens.</td>
                  <td data-label="カタカナ・発音ヒント">トッツィンス /tɔt ˈzins/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>また後でね。</strong>カジュアルな別れ</td>
                  <td data-label="オランダ語">Tot later.</td>
                  <td data-label="カタカナ・発音ヒント">トト ラーテル /tɔt ˈlaːtər/</td>
                </tr>
              </tbody>
            </table>
          </section>

          <section class="card phrase-section">
            <h3>旅行</h3>
            <table class="phrase-table">
              <thead>
                <tr>
                  <th scope="col">日本語</th>
                  <th scope="col">オランダ語</th>
                  <th scope="col">カタカナ・発音ヒント</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="日本語"><strong>駅はどこですか？</strong>場所を尋ねる</td>
                  <td data-label="オランダ語">Waar is het station?</td>
                  <td data-label="カタカナ・発音ヒント">ワール イス ヘット スタシオン /ʋaːr ɪs ɦət stɑˈʃɔn/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>この列車はアムステルダム行きですか？</strong></td>
                  <td data-label="オランダ語">Gaat deze trein naar Amsterdam?</td>
                  <td data-label="カタカナ・発音ヒント">ハート デーゼ トライン ナール アムステルダム /ɣaːt ˈdeːzə trɛi̯n naːr ˌɑmstərˈdɑm/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>切符を2枚ください。</strong></td>
                  <td data-label="オランダ語">Mag ik twee kaartjes alstublieft?</td>
                  <td data-label="カタカナ・発音ヒント">マッ フィック トゥウェー カールチェス アルストュブリーフト /mɑx ɪk tveː ˈkaːr.cəs ˌɑlstʏˈblift/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>チェックインをお願いします。</strong>ホテルで</td>
                  <td data-label="オランダ語">Ik wil graag inchecken.</td>
                  <td data-label="カタカナ・発音ヒント">イク ヴィル フラーフ インチェッケン /ɪk ʋɪl ɣraːx ˈɪnˌtʃɛkə(n)/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>おすすめのレストランはありますか？</strong></td>
                  <td data-label="オランダ語">Heeft u een aanbeveling voor een restaurant?</td>
                  <td data-label="カタカナ・発音ヒント">ヘーフトゥー ウン アーンベーフェイリング フォール ウン レストラン /ɦeːft y ʏn ˈaːm.beːˌveː.lɪŋ foːr ʏn ˌrɛstɔˈrɑnt/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>助けが必要です。</strong>緊急時</td>
                  <td data-label="オランダ語">Ik heb hulp nodig.</td>
                  <td data-label="カタカナ・発音ヒント">イク ヘップ フルプ ノーディフ /ɪk ɦɛb ɦʏlp ˈnoːdɪx/</td>
                </tr>
                <tr>
                  <td data-label="日本語"><strong>トイレはどこですか？</strong></td>
                  <td data-label="オランダ語">Waar is het toilet?</td>
                  <td data-label="カタカナ・発音ヒント">ワール イス ヘット トワレット /ʋaːr ɪs ɦət twɑˈlɛt/</td>
                </tr>
              </tbody>
            </table>
          </section>
        </section>

        <section
          id="mode-panel-game"
          class="mode-panel"
          role="tabpanel"
          aria-labelledby="mode-tab-game"
          data-mode-panel="game"
          hidden
          aria-hidden="true"
        >
          <section class="card game-section">
            <div class="game-intro">
              <h2>フレーズチャレンジモード</h2>
              <p>
                日本語カードとオランダ語カードをタップしてペアを見つける、テンポの良いマッチングゲームです。耳と目を同時に使いながら、短時間で何度も遊んでみましょう。
              </p>
            </div>
            <div class="game-meta">
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">Stage</span>
                <span class="meta-value"><span id="game-stage">0</span><small>段</small></span>
              </div>
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">Score</span>
                <span class="meta-value" id="game-score">0</span>
              </div>
              <div class="meta-box" aria-live="polite">
                <span class="meta-label">連続正解</span>
                <span class="meta-value"><span id="game-streak">0</span><small id="game-best">BEST 0</small></span>
              </div>
            </div>
            <div class="game-controls">
              <button id="game-start-button" class="game-button" type="button">ステージを始める</button>
              <button id="game-reset-button" class="game-button secondary" type="button">スコアをリセット</button>
            </div>
            <p id="game-status" class="game-status" aria-live="polite">ステージを始めてカードをマッチさせましょう！</p>
            <div
              id="game-grid"
              class="game-card-grid"
              aria-label="日本語とオランダ語のカードをマッチさせるグリッド"
              aria-live="polite"
            ></div>
          </section>
        </section>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2024 NederLingo. All rights reserved.
  </footer>

  <script>
    const PHRASE_DATA = [
      {
        id: 'greet-morning',
        category: 'greetings',
        ja: 'おはようございます。',
        nl: 'Goedemorgen.',
        hint: 'フーデモルヘン /ɣudəˈmɔr.ɣə(n)/',
        featured: true,
      },
      {
        id: 'greet-day',
        category: 'greetings',
        ja: 'こんにちは。',
        nl: 'Goedemiddag.',
        hint: 'フーデミダフ /ɣudəˈmɪdɑx/',
      },
      {
        id: 'greet-evening',
        category: 'greetings',
        ja: 'こんばんは。',
        nl: 'Goedenavond.',
        hint: 'フーデナーフォント /ɣudəˈnaːvɔnt/',
      },
      {
        id: 'greet-meet',
        category: 'greetings',
        ja: 'はじめまして。',
        nl: 'Aangenaam.',
        hint: 'アーネナーム /ˈaːŋɣənaːm/',
      },
      {
        id: 'greet-bye',
        category: 'greetings',
        ja: 'さようなら。',
        nl: 'Tot ziens.',
        hint: 'トッツィンス /tɔt ˈzins/',
      },
      {
        id: 'greet-later',
        category: 'greetings',
        ja: 'また後でね。',
        nl: 'Tot later.',
        hint: 'トト ラーテル /tɔt ˈlaːtər/',
      },
      {
        id: 'polite-thanks',
        category: 'essentials',
        ja: 'ありがとうございます。',
        nl: 'Dank u wel.',
        hint: 'ダンク ウ ヴェル /dɑŋk y ʋɛl/',
        featured: true,
      },
      {
        id: 'polite-sorry',
        category: 'essentials',
        ja: 'すみません。',
        nl: 'Pardon.',
        hint: 'パルドン /ˈpɑr.dɔn/',
        featured: true,
      },
      {
        id: 'travel-station',
        category: 'travel',
        ja: '駅はどこですか？',
        nl: 'Waar is het station?',
        hint: 'ワール イス ヘット スタシオン /ʋaːr ɪs ɦət stɑˈʃɔn/',
        featured: true,
      },
      {
        id: 'travel-train',
        category: 'travel',
        ja: 'この列車はアムステルダム行きですか？',
        nl: 'Gaat deze trein naar Amsterdam?',
        hint: 'ハート デーゼ トライン ナール アムステルダム /ɣaːt ˈdeːzə trɛi̯n naːr ˌɑmstərˈdɑm/',
      },
      {
        id: 'travel-ticket',
        category: 'travel',
        ja: '切符を2枚ください。',
        nl: 'Mag ik twee kaartjes alstublieft?',
        hint: 'マッ フィック トゥウェー カールチェス アルストュブリーフト /mɑx ɪk tveː ˈkaːr.cəs ˌɑlstʏˈblift/',
      },
      {
        id: 'travel-checkin',
        category: 'travel',
        ja: 'チェックインをお願いします。',
        nl: 'Ik wil graag inchecken.',
        hint: 'イク ヴィル フラーフ インチェッケン /ɪk ʋɪl ɣraːx ˈɪnˌtʃɛkə(n)/',
      },
      {
        id: 'travel-restaurant',
        category: 'travel',
        ja: 'おすすめのレストランはありますか？',
        nl: 'Heeft u een aanbeveling voor een restaurant?',
        hint: 'ヘーフトゥー ウン アーンベーフェイリング フォール ウン レストラン /ɦeːft y ʏn ˈaːm.beːˌveː.lɪŋ foːr ʏn ˌrɛstɔˈrɑnt/',
      },
      {
        id: 'emergency-help',
        category: 'essentials',
        ja: '助けが必要です。',
        nl: 'Ik heb hulp nodig.',
        hint: 'イク ヘップ フルプ ノーディフ /ɪk ɦɛb ɦʏlp ˈnoːdɪx/',
        featured: true,
      },
      {
        id: 'travel-restroom',
        category: 'travel',
        ja: 'トイレはどこですか？',
        nl: 'Waar is het toilet?',
        hint: 'ワール イス ヘット トワレット /ʋaːr ɪs ɦət twɑˈlɛt/',
      },
    ];

    const PHRASE_LOOKUP = new Map(PHRASE_DATA.map((phrase) => [phrase.id, phrase]));

    const shuffleArray = (input) => {
      const array = [...input];

      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }

      return array;
    };

    const phraseListElement = document.querySelector('[data-phrase-list]');

    const renderStudyList = () => {
      if (!phraseListElement) {
        return;
      }

      phraseListElement.innerHTML = '';

      const featuredPhrases = PHRASE_DATA.filter((phrase) => phrase.featured);
      const fragment = document.createDocumentFragment();

      featuredPhrases.forEach((phrase) => {
        const item = document.createElement('li');
        item.dataset.phraseId = phrase.id;

        const original = document.createElement('span');
        original.className = 'phrase-original';
        original.textContent = phrase.ja;

        const translation = document.createElement('span');
        translation.className = 'phrase-translation is-hidden';
        translation.textContent = phrase.nl;

        const speakButton = document.createElement('button');
        speakButton.type = 'button';
        speakButton.className = 'speak-phrase speak-control';
        speakButton.dataset.speech = phrase.nl;
        speakButton.dataset.defaultLabel = '再生';
        speakButton.dataset.activeLabel = '再生中…';
        speakButton.setAttribute('aria-label', `${phrase.ja} をオランダ語で再生`);
        speakButton.textContent = '再生';

        const recognizeButton = document.createElement('button');
        recognizeButton.type = 'button';
        recognizeButton.className = 'recognize-phrase';
        recognizeButton.dataset.target = phrase.nl;
        recognizeButton.setAttribute('aria-label', `${phrase.nl} を発音してみよう`);
        recognizeButton.textContent = '発声テスト';

        const toggleButton = document.createElement('button');
        toggleButton.type = 'button';
        toggleButton.className = 'toggle-translation';
        toggleButton.textContent = '訳を表示';

        toggleButton.addEventListener('click', () => {
          translation.classList.toggle('is-hidden');
          toggleButton.textContent = translation.classList.contains('is-hidden')
            ? '訳を表示'
            : '訳を隠す';
        });

        item.append(original, translation, speakButton, recognizeButton, toggleButton);
        fragment.appendChild(item);
      });

      phraseListElement.appendChild(fragment);
    };

    renderStudyList();

    const modeContainer = document.querySelector('.main-container');
    const modeButtons = modeContainer
      ? Array.from(modeContainer.querySelectorAll('[data-mode]'))
      : [];
    const modePanels = modeContainer
      ? Array.from(modeContainer.querySelectorAll('[data-mode-panel]'))
      : [];

    if (modeContainer && modeButtons.length > 0 && modePanels.length > 0) {
      const setActiveMode = (mode) => {
        modeContainer.dataset.activeMode = mode;

        modeButtons.forEach((button) => {
          const targetMode = button.getAttribute('data-mode');
          const isActive = targetMode === mode;

          button.setAttribute('aria-selected', String(isActive));
          button.setAttribute('tabindex', isActive ? '0' : '-1');
        });

        modePanels.forEach((panel) => {
          const panelMode = panel.getAttribute('data-mode-panel');
          const isActive = panelMode === mode;

          panel.toggleAttribute('hidden', !isActive);
          panel.setAttribute('aria-hidden', String(!isActive));
        });
      };

      const availableModes = modeButtons
        .map((button) => button.getAttribute('data-mode'))
        .filter((value) => typeof value === 'string' && value.length > 0);

      let initialMode = modeContainer.dataset.activeMode;

      if (!initialMode || !availableModes.includes(initialMode)) {
        initialMode = availableModes[0];
      }

      setActiveMode(initialMode);

      modeButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const mode = button.getAttribute('data-mode');

          if (!mode) {
            return;
          }

          setActiveMode(mode);
        });

        button.addEventListener('keydown', (event) => {
          const currentIndex = modeButtons.indexOf(button);
          let targetIndex = null;

          if (event.key === 'ArrowRight' || event.key === 'ArrowDown') {
            targetIndex = (currentIndex + 1) % modeButtons.length;
          } else if (event.key === 'ArrowLeft' || event.key === 'ArrowUp') {
            targetIndex =
              (currentIndex - 1 + modeButtons.length) % modeButtons.length;
          } else if (event.key === 'Home') {
            targetIndex = 0;
          } else if (event.key === 'End') {
            targetIndex = modeButtons.length - 1;
          }

          if (targetIndex !== null) {
            event.preventDefault();

            const targetButton = modeButtons[targetIndex];
            const mode = targetButton?.getAttribute('data-mode');

            if (mode) {
              setActiveMode(mode);
              targetButton.focus();
            }
          }
        });
      });
    }

    const rateSlider = document.getElementById('speech-rate');
    const rateValue = document.getElementById('speech-rate-value');

    if (rateSlider && rateValue) {
      const updateRateLabel = () => {
        rateValue.textContent = `${parseFloat(rateSlider.value).toFixed(1)}x`;
      };

      rateSlider.addEventListener('input', updateRateLabel);
      updateRateLabel();
    }

    if ('speechSynthesis' in window) {
      const synthesis = window.speechSynthesis;
      let availableVoices = [];
      let activeButton = null;

      const refreshVoices = () => {
        availableVoices = synthesis
          .getVoices()
          .filter((voice) => voice.lang && voice.lang.toLowerCase().startsWith('nl'));

        if (availableVoices.length === 0) {
          availableVoices = synthesis.getVoices();
        }
      };

      const resetActiveButton = () => {
        if (activeButton) {
          activeButton.disabled = false;
          const defaultLabel = activeButton.dataset.defaultLabel ?? '再生';
          activeButton.textContent = defaultLabel;
          activeButton = null;
        }
      };

      const speakFromButton = (button) => {
        const dutchText = button.dataset.speech?.trim();

        if (!dutchText) {
          return;
        }

        if (!button.dataset.defaultLabel) {
          button.dataset.defaultLabel = button.textContent;
        }

        if (synthesis.speaking || synthesis.pending) {
          synthesis.cancel();
        }

        resetActiveButton();

        const utterance = new SpeechSynthesisUtterance(dutchText);
        utterance.lang = 'nl-NL';

        if (rateSlider) {
          utterance.rate = parseFloat(rateSlider.value) || 1;
        }

        const selectedVoice = availableVoices.find(
          (voice) => voice.lang && voice.lang.toLowerCase().startsWith('nl')
        );

        if (selectedVoice) {
          utterance.voice = selectedVoice;
        }

        utterance.onend = () => {
          if (activeButton === button) {
            button.disabled = false;
            button.textContent = button.dataset.defaultLabel ?? '再生';
            activeButton = null;
          }
        };

        utterance.onerror = () => {
          if (activeButton === button) {
            button.disabled = false;
            button.textContent = button.dataset.defaultLabel ?? '再生';
            activeButton = null;
          }
        };

        activeButton = button;
        button.disabled = true;
        button.textContent = button.dataset.activeLabel ?? '再生中…';

        synthesis.speak(utterance);
      };

      const handleSpeakClick = (event) => {
        const button = event.target.closest('.speak-control');

        if (!button) {
          return;
        }

        event.preventDefault();
        event.stopPropagation();

        if (availableVoices.length === 0) {
          refreshVoices();
        }

        speakFromButton(button);
      };

      refreshVoices();
      synthesis.addEventListener('voiceschanged', refreshVoices);
      document.addEventListener('click', handleSpeakClick);
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognitionNotice = document.getElementById('speech-recognition-notice');
    const recognitionPanel = document.getElementById('recognition-panel');
    const recognitionStatus = document.getElementById('recognition-status');
    const recognitionTarget = document.getElementById('recognition-target');
    const recognitionText = document.getElementById('recognition-text');
    const recognitionScore = document.getElementById('recognition-score');

    const defaultStatusMessage = 'マイクの許可を与えて「発声テスト」を押すと発音チェックができます。';

    const sanitizePhrase = (text) =>
      text
        .toLowerCase()
        .replace(/[^a-zà-ž\s']/gi, ' ')
        .replace(/\s+/g, ' ')
        .trim();

    const computeSimilarity = (a, b) => {
      const source = sanitizePhrase(a);
      const target = sanitizePhrase(b);

      if (!source && !target) {
        return 1;
      }

      if (!source || !target) {
        return 0;
      }

      const rows = source.length + 1;
      const cols = target.length + 1;
      const dp = Array.from({ length: rows }, () => new Array(cols).fill(0));

      for (let i = 0; i < rows; i += 1) {
        dp[i][0] = i;
      }

      for (let j = 0; j < cols; j += 1) {
        dp[0][j] = j;
      }

      for (let i = 1; i < rows; i += 1) {
        for (let j = 1; j < cols; j += 1) {
          const cost = source[i - 1] === target[j - 1] ? 0 : 1;
          dp[i][j] = Math.min(
            dp[i - 1][j] + 1,
            dp[i][j - 1] + 1,
            dp[i - 1][j - 1] + cost
          );
        }
      }

      const distance = dp[rows - 1][cols - 1];
      const longest = Math.max(source.length, target.length);

      return longest === 0 ? 1 : 1 - distance / longest;
    };

    if (
      recognitionNotice &&
      recognitionPanel &&
      recognitionStatus &&
      recognitionTarget &&
      recognitionText &&
      recognitionScore
    ) {
      if (!SpeechRecognition) {
        recognitionNotice.textContent =
          'お使いのブラウザは音声認識に対応していません。Chromeなどの対応ブラウザでお試しください。';
        recognitionNotice.classList.remove('is-hidden');
        recognitionPanel.classList.add('is-hidden');
      } else {
        recognitionPanel.classList.remove('is-hidden');
        recognitionNotice.textContent = '初回利用時はブラウザのマイク許可が求められます。';
        recognitionNotice.classList.remove('is-hidden');
        recognitionStatus.textContent = defaultStatusMessage;

        const recognition = new SpeechRecognition();
        recognition.lang = 'nl-NL';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        let activeRecognitionButton = null;
        let targetPhrase = '';

        const releaseRecognitionButton = () => {
          if (activeRecognitionButton) {
            activeRecognitionButton.disabled = false;
            activeRecognitionButton.textContent = '発声テスト';
            activeRecognitionButton = null;
          }
        };

        recognition.addEventListener('start', () => {
          recognitionStatus.textContent = '録音中です。話し終えたら自動的に判定します。';
        });

        recognition.addEventListener('result', (event) => {
          const transcript = event.results[0][0]?.transcript?.trim() ?? '';
          recognitionText.textContent = transcript || '-';
          recognitionTarget.textContent = targetPhrase || '-';

          const similarity = computeSimilarity(transcript, targetPhrase);
          const percentage = Math.round(similarity * 100);
          recognitionScore.textContent = Number.isNaN(percentage) ? '-' : `${percentage}%`;
        });

        recognition.addEventListener('error', (event) => {
          recognitionStatus.textContent = `エラーが発生しました: ${event.error}`;
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';
          releaseRecognitionButton();
        });

        recognition.addEventListener('nomatch', () => {
          recognitionStatus.textContent = '音声を認識できませんでした。もう一度お試しください。';
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';
        });

        recognition.addEventListener('end', () => {
          releaseRecognitionButton();

          if (recognitionStatus.textContent.startsWith('録音中です')) {
            recognitionStatus.textContent = defaultStatusMessage;
          }
        });

        const handleRecognitionClick = (event) => {
          const button = event.target.closest('.recognize-phrase');

          if (!button) {
            return;
          }

          event.preventDefault();
          event.stopPropagation();

          const dutchText = button.dataset.target?.trim();

          if (!dutchText) {
            return;
          }

          if (activeRecognitionButton) {
            try {
              recognition.abort();
            } catch (error) {
              /* noop */
            }
            releaseRecognitionButton();
          }

          targetPhrase = dutchText;
          recognitionTarget.textContent = dutchText;
          recognitionText.textContent = '-';
          recognitionScore.textContent = '-';

          activeRecognitionButton = button;
          button.disabled = true;
          button.textContent = '録音中…';

          try {
            recognition.start();
          } catch (error) {
            recognitionStatus.textContent =
              '音声認識の開始に失敗しました。もう一度お試しください。';
            releaseRecognitionButton();
            targetPhrase = '';
            recognitionTarget.textContent = '-';
            recognitionText.textContent = '-';
            recognitionScore.textContent = '-';
          }
        };

        document.addEventListener('click', handleRecognitionClick);

        window.addEventListener('beforeunload', () => {
          try {
            recognition.stop();
          } catch (error) {
            /* noop */
          }
        });
      }
    }

    const gameGrid = document.getElementById('game-grid');
    const gameStatus = document.getElementById('game-status');
    const stageDisplay = document.getElementById('game-stage');
    const scoreDisplay = document.getElementById('game-score');
    const streakDisplay = document.getElementById('game-streak');
    const bestDisplay = document.getElementById('game-best');
    const startButton = document.getElementById('game-start-button');
    const resetButton = document.getElementById('game-reset-button');

    const gameState = {
      stage: 0,
      score: 0,
      streak: 0,
      best: 0,
      matchesRemaining: 0,
      selection: [],
      busy: false,
    };

    const pulseElement = (element) => {
      if (!element) {
        return;
      }

      element.classList.remove('score-pulse');
      void element.offsetWidth;
      element.classList.add('score-pulse');
    };

    const stagePairCount = (stageNumber) =>
      Math.min(3 + stageNumber, Math.min(6, PHRASE_DATA.length));

    const setStatus = (message) => {
      if (gameStatus) {
        gameStatus.textContent = message;
      }
    };

    const updateScoreboard = () => {
      if (stageDisplay) {
        stageDisplay.textContent = gameState.stage;
      }

      if (scoreDisplay) {
        scoreDisplay.textContent = gameState.score;
      }

      if (streakDisplay) {
        streakDisplay.textContent = gameState.streak;
      }

      if (bestDisplay) {
        bestDisplay.textContent = `BEST ${gameState.best}`;
      }
    };

    const buildHintMessage = (phrase, lang) => {
      if (!phrase) {
        return '';
      }

      if (lang === 'ja') {
        let hint = `オランダ語: ${phrase.nl}`;

        if (phrase.hint) {
          hint += `\n発音ヒント: ${phrase.hint}`;
        }

        return hint;
      }

      let hint = `日本語: ${phrase.ja}`;

      if (phrase.hint) {
        hint += `\n発音ヒント: ${phrase.hint}`;
      }

      return hint;
    };

    const createGameCard = (phrase, lang) => {
      const card = document.createElement('div');
      card.className = 'game-card';
      card.dataset.pairId = phrase.id;
      card.dataset.lang = lang;

      const mainButton = document.createElement('button');
      mainButton.type = 'button';
      mainButton.className = 'game-card-main';

      const labelText = lang === 'ja' ? '日本語' : 'オランダ語';
      const displayText = lang === 'ja' ? phrase.ja : phrase.nl;
      mainButton.setAttribute('aria-label', `${labelText}カード: ${displayText}`);

      const textSpan = document.createElement('span');
      textSpan.className = 'game-card-text';
      textSpan.textContent = displayText;

      const labelSpan = document.createElement('span');
      labelSpan.className = 'game-card-label';
      labelSpan.textContent = labelText;

      mainButton.append(textSpan, labelSpan);

      const actions = document.createElement('div');
      actions.className = 'game-card-actions';

      const speakButton = document.createElement('button');
      speakButton.type = 'button';
      speakButton.className = 'card-action speak-control';
      speakButton.dataset.speech = phrase.nl;
      speakButton.dataset.defaultLabel = '🔊';
      speakButton.dataset.activeLabel = '🔄';
      speakButton.setAttribute('aria-label', `${phrase.ja} のオランダ語を再生`);
      speakButton.textContent = '🔊';

      const hintButton = document.createElement('button');
      hintButton.type = 'button';
      hintButton.className = 'card-action card-hint';
      hintButton.setAttribute('aria-expanded', 'false');
      hintButton.textContent = 'ヒント';

      actions.append(speakButton, hintButton);

      const hintText = document.createElement('p');
      hintText.className = 'game-card-hint';
      hintText.hidden = true;

      card.append(mainButton, actions, hintText);

      return card;
    };

    const resetGame = (announce = true) => {
      gameState.stage = 0;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.best = 0;
      gameState.matchesRemaining = 0;
      gameState.selection = [];
      gameState.busy = false;
      updateScoreboard();

      if (gameGrid) {
        gameGrid.innerHTML = '';
      }

      if (startButton) {
        startButton.disabled = false;
        startButton.textContent = 'ステージを始める';
      }

      if (announce) {
        setStatus('ステージを始めてカードをマッチさせましょう！');
      }
    };

    const stageClearFeedback = () => {
      const bonus = 20;
      gameState.score += bonus;
      updateScoreboard();
      pulseElement(scoreDisplay);

      if (startButton) {
        startButton.disabled = false;
        startButton.textContent = '次のステージへ';
      }

      setStatus(`✨ ステージ${gameState.stage}クリア！ボーナス${bonus}点を獲得したよ。`);
    };

    const evaluateSelection = () => {
      if (gameState.selection.length < 2) {
        return;
      }

      gameState.busy = true;

      const [first, second] = gameState.selection;
      const isMatch = first.pairId === second.pairId && first.lang !== second.lang;

      if (isMatch) {
        const phrase = PHRASE_LOOKUP.get(first.pairId);
        [first.card, second.card].forEach((card) => {
          card.classList.remove('is-selected');
          card.classList.add('is-matched', 'is-disabled');
        });

        gameState.matchesRemaining -= 1;
        gameState.streak += 1;

        if (gameState.streak > gameState.best) {
          gameState.best = gameState.streak;
        }

        const gained = 10 + gameState.streak * 2;
        gameState.score += gained;
        updateScoreboard();
        pulseElement(scoreDisplay);
        pulseElement(streakDisplay);

        if (phrase) {
          setStatus(`🎉 正解！「${phrase.ja}」と「${phrase.nl}」で${gained}点ゲット！`);
        } else {
          setStatus('🎉 正解！すばらしい！');
        }

        gameState.selection = [];
        gameState.busy = false;

        if (gameState.matchesRemaining === 0) {
          stageClearFeedback();
        }

        return;
      }

      gameState.streak = 0;
      updateScoreboard();
      pulseElement(streakDisplay);
      setStatus('あれ？違うみたい。落ち着いてもう一度！');

      const [firstCard, secondCard] = [first.card, second.card];

      setTimeout(() => {
        firstCard.classList.remove('is-selected');
        secondCard.classList.remove('is-selected');
        gameState.selection = [];
        gameState.busy = false;
      }, 700);
    };

    const handleCardSelection = (card) => {
      if (!card || gameState.busy) {
        return;
      }

      if (card.classList.contains('is-matched') || card.classList.contains('is-disabled')) {
        return;
      }

      const pairId = card.getAttribute('data-pair-id');
      const lang = card.getAttribute('data-lang');

      if (!pairId || !lang) {
        return;
      }

      if (gameState.selection.length === 0) {
        gameState.selection.push({ card, pairId, lang });
        card.classList.add('is-selected');
        setStatus('もう1枚選んでペアを作ろう！');
        return;
      }

      const [firstSelection] = gameState.selection;

      if (firstSelection.card === card) {
        card.classList.remove('is-selected');
        gameState.selection = [];
        setStatus('カードを選び直したよ。');
        return;
      }

      if (firstSelection.lang === lang) {
        firstSelection.card.classList.remove('is-selected');
        gameState.selection = [{ card, pairId, lang }];
        card.classList.add('is-selected');
        setStatus('もう1枚選んでペアを作ろう！');
        return;
      }

      gameState.selection.push({ card, pairId, lang });
      card.classList.add('is-selected');
      evaluateSelection();
    };

    const startStage = () => {
      if (!gameGrid) {
        return;
      }

      const nextStage = gameState.stage + 1;
      const pairCount = stagePairCount(nextStage);

      if (pairCount <= 0) {
        setStatus('利用できるカードが足りません。');
        return;
      }

      const selectedPairs = shuffleArray(PHRASE_DATA).slice(0, pairCount);
      const cards = shuffleArray(
        selectedPairs.flatMap((phrase) => [
          { phrase, lang: 'ja' },
          { phrase, lang: 'nl' },
        ])
      );

      gameGrid.setAttribute('aria-busy', 'true');
      gameGrid.innerHTML = '';

      const fragment = document.createDocumentFragment();
      cards.forEach(({ phrase, lang }) => {
        fragment.appendChild(createGameCard(phrase, lang));
      });

      gameGrid.appendChild(fragment);
      gameGrid.removeAttribute('aria-busy');

      gameState.stage = nextStage;
      gameState.matchesRemaining = selectedPairs.length;
      gameState.selection = [];
      gameState.busy = false;

      if (startButton) {
        startButton.disabled = true;
        startButton.textContent = 'プレイ中…';
      }

      updateScoreboard();
      setStatus(`ステージ${gameState.stage}スタート！同じ意味のカードをタップしてね。`);
    };

    if (gameGrid) {
      gameGrid.addEventListener('click', (event) => {
        const hintButton = event.target.closest('.card-hint');

        if (hintButton) {
          event.preventDefault();
          event.stopPropagation();

          const card = hintButton.closest('.game-card');
          const pairId = card?.getAttribute('data-pair-id');
          const lang = card?.getAttribute('data-lang');

          if (!card || !pairId || !lang) {
            return;
          }

          const phrase = PHRASE_LOOKUP.get(pairId);
          const hintArea = card.querySelector('.game-card-hint');

          if (!phrase || !hintArea) {
            return;
          }

          const willShow = hintArea.hidden;

          if (willShow) {
            hintArea.textContent = buildHintMessage(phrase, lang);
          }

          hintArea.hidden = !willShow;
          hintButton.textContent = willShow ? 'ヒントをとじる' : 'ヒント';
          hintButton.setAttribute('aria-expanded', String(willShow));
          setStatus(willShow ? 'ヒントを参考にしてペアを探してみよう！' : 'ヒントを閉じました。');

          return;
        }

        const mainButton = event.target.closest('.game-card-main');

        if (mainButton) {
          event.preventDefault();
          const card = mainButton.closest('.game-card');
          handleCardSelection(card);
        }
      });
    }

    if (startButton) {
      startButton.addEventListener('click', () => {
        if (startButton.disabled) {
          return;
        }

        startStage();
      });
    }

    if (resetButton) {
      resetButton.addEventListener('click', () => {
        resetGame();
        if (startButton) {
          startButton.focus();
        }
      });
    }

    resetGame();
  </script>

</body>
</html>
